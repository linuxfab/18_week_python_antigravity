# 第 09 週 | 碰撞檢測：從「位移」進化到「互動」

> **給老師的備課筆記**：
> 這是遊戲從「動畫」轉向「模擬」的關鍵。
> 之前蛇只是在練習折返跑，現在它有了「獵物」。
> 國中生最常搞混的是：為什麼座標完全相等才算吃到？(因為我們在網格上移動)。

---

## 🎯 本週教學目標

1.  **碰撞邏輯 (Collision Detection)**：電腦如何判斷兩個物體「撞在一起」？
2.  **成長機制 (Growth Mechanism)**：理解 List 的 `pop(0)` 與 `append()` 組合技。
3.  **條件旗標 (Flag)**：使用 `bool` 變數來傳遞訊息。

---

## 💡 深度比喻：特戰英豪與碰撞箱 (Hitbox)

想像所有遊戲角色外面都有一層看不見的「盒子」。
在射擊遊戲裡，子彈的盒子撞到角色的盒子，就是「擊中」。
在我們的貪食蛇裡，蛇頭的盒子 (40x40) 座標完全等於食物的盒子座標，這就是「捕食」。

### 蛇是如何長大的？(火車理論)
*   **平時**：火車每往前開一節，車尾就拿掉一節。長度不變。
*   **吃到食物**：火車往前開一節，但我們先不叫車尾的人走開。火車就變長了！
*   **程式翻譯**：
    *   `pop(0)` = 叫車尾的人走開。
    *   `append()` = 叫新的頭進來。
    *   `if should_grow`: 這次不執行 `pop(0)`。

---

## 📝 程式碼拆解 (關鍵邏輯)

### 1. 座標重疊檢查
```python
if head_x == food_x and head_y == food_y:
    should_grow = True 
    spawn_food() 
```
*   **注意**：這只有在「一格一格跳」的遊戲裡有效。如果你的蛇移動速度是 3.5 像素，它們可能永遠不會「完全相等」，那就要改用 `pygame.Rect.colliderect`。

### 2. 生食邏輯
```python
while True:
    # 隨機選座標...
    if (food_x, food_y) not in snake_body:
        break # 確保食物不會生在蛇肚子裡，這叫「防呆設計」
```

---

## ✨ Vibe Coding 小撇步：打擊感 (Juiciness)

讓遊戲變好玩的祕訣在於「反饋」。
*   **螢幕閃爍**：吃到食物的瞬間，背景顏色變白 0.1 秒，會有「閃光彈」的爽快感。
*   **吃掉特效**：
    ```python
    if spawn_timer > 0:
        screen.fill((50, 20, 20)) # 極簡的衝擊視覺
        spawn_timer -= 1
    ```

---

## ⚠️ 常見陷阱 (Pitfalls)

1.  **座標對不準**：如果你發現蛇明明穿過食物卻沒吃到，檢查你的 `block_size` 是否一致。
2.  **長太快**：初學者常忘了吃到後要重置 `should_grow = False`，結果蛇變成一條無止盡的雷射光。

---

## 🏋️‍♂️ 課後練習

1.  **大胃王挑戰**：試著修改程式，讓蛇每吃一顆食物就一次長大 3 節。
2.  **隨機驚喜**：改寫 `spawn_food`，讓食物也有 10% 機率生成「黃金蘋果」，吃了會長大 5 節。

---

## 📚 參考來源
*   [Pygame Rect Collision](https://www.pygame.org/docs/ref/rect.html#pygame.Rect.colliderect)
*   [Game Feel: The Secret Sauce](https://www.youtube.com/watch?v=216_5nu7a8o) (聽說好遊戲的秘密都在這裡)
